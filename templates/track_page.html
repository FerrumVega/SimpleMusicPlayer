<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>{{ song_full_name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="theme-dark">
    <div>
        <h1>{{ song_full_name }}</h1>
        <img src="{{ song_cover }}" class="spinning-img"></img>
        <audio controls src="{{ song_url }}" preload="metadata" id="player"
            onplay="document.querySelector('.spinning-img').style.animation = 'spinning 10s linear infinite';"
            onpause="document.querySelector('.spinning-img').style.animation = 'none';" ontimeupdate="
                if (new URLSearchParams(window.location.search).get('from_wave') === 'true') {
                    let playerPos = player.currentTime;
                    if (playerPos / player.duration >= 0.8 && !listened) {
                        var xhr = new XMLHttpRequest();
                        xhr.open('POST', `/feedback/ended/?player_pos=${playerPos}&track_id=${trackId}`, true);
                        xhr.onload = function() {console.log(xhr.status)};
                        xhr.send();
                        listened = true;
                    }
                }
            "></audio>
        <button type="button" id="like" onclick="{
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'like', true);
            xhr.onload = function() {console.log(xhr.status)};
            xhr.send();
        }">
            ‚ù§Ô∏è
        </button>
        <button type="button" id="dislike" onclick="{
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'dislike', true);
            xhr.onload = function() {console.log(xhr.status)};
            xhr.send();
        }">
            üíî
        </button>
        <a href="{{ previous_track_url }}">
            <button type="button">
                –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫
            </button>
        </a>
        <a href="{{ next_track_url }}">
            <button type="button" onclick="if (!listened) {
                    let playerPos = player.currentTime;
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', `/feedback/skipped/?player_pos=${playerPos}&track_id=${trackId}`, true);
                    xhr.onload = function() {console.log(xhr.status)};
                    xhr.send();
                }">
                –°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫
            </button>
        </a>
        <a href="/">
            <button type="button">
                –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </button>
        </a>
        <p>{{ song_lyrics|safe }}</p>
        <p>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç. –ú–µ—Ç–∫–∞ <strong>[E]</strong> –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Ç—Ä–µ–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω
            —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö. –ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ª—é–±–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç, —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã–π –Ω–∞ —Å–∞–π—Ç–µ.</p>
    </div>
    <script>
        if (new URLSearchParams(window.location.search).get("from_wave") === "true") {
            var trackId = window.location.pathname.split("/")[2]
            var listened = false
        }
        navigator.mediaSession.metadata = new MediaMetadata({ title: '{{ song_title }}', artist: '{{ song_artists }}', artwork: [{ src: '{{ song_cover }}', sizes: '1080x1080', type: 'image/png' }] })
    </script>
</body>

</html>