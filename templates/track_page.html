<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>{{ song_full_name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="theme-dark">
    <div>
        <h1>{{ song_full_name }}</h1>
        <img src="{{ song_cover }}" class="spinning-img"></img>
        <audio controls src="{{ song_url }}" preload="metadata" id="player"></audio>
        <button type="button" id="like">
            ‚ù§Ô∏è
        </button>
        <button type="button" id="dislike">
            üíî
        </button>
        <a href="{{ previous_track_url }}">
            <button type="button">
                –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫
            </button>
        </a>
        <a href="{{ next_track_url }}">
            <button type="button" id="next_track_button">
                –°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫
            </button>
        </a>
        <a href="/">
            <button type="button">
                –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </button>
        </a>
        <p>{{ song_lyrics|safe }}</p>
        <p>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç. –ú–µ—Ç–∫–∞ <strong>[E]</strong> –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Ç—Ä–µ–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω
            —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö. –ê–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ª—é–±–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç, —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã–π –Ω–∞ —Å–∞–π—Ç–µ.</p>
    </div>
    <script>
        function sendFeedback(url, showAlert) {
            var feedback = new XMLHttpRequest()
            feedback.open("POST", url, true)
            feedback.send()
            if (showAlert) { feedback.onload = function () { alert(feedback.responseText) } }
        }

        window.addEventListener("load", function () {
            var img = document.querySelector(".spinning-img")
            var player = document.getElementById("player")
            player.addEventListener("play", function () { img.style.animation = "spinning 10s linear infinite" })
            player.addEventListener("pause", function () { img.style.animation = "none" })

            if (window.location.search.indexOf("from_wave=true") !== -1) {
                var trackId = window.location.pathname.split("/")[2]
                var listened = false
                player.addEventListener("timeupdate", function () {
                    var playerPos = player.currentTime
                    if (playerPos / player.duration >= 0.8 && !listened && !isNaN(player.duration)) {
                        listened = true
                        sendFeedback('/feedback/ended/?player_pos=' + playerPos + '&track_id=' + trackId, false)
                    }
                })
                var next_track_button = document.getElementById("next_track_button")
                next_track_button.addEventListener("click", function () {
                    if (!listened) {
                        var playerPos = player.currentTime
                        sendFeedback('/feedback/skipped/?player_pos=' + playerPos + '&track_id=' + trackId, false)
                    }
                })
            }



            var like_button = document.getElementById("like")
            like_button.addEventListener("click", function () { sendFeedback("like", true); })
            var dislike_button = document.getElementById("dislike")
            dislike_button.addEventListener("click", function () { sendFeedback("dislike", true); })
        });
    </script>
</body>

</html>